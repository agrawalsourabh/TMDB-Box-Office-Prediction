# Plots graphs
# installing Packages
install.packages("scales")
install.packages("ddply")

# loading packages
library(scales)
library(ggplot2)


# Scatter plot for budget and revenue for training data
ggplot(data = my.data[which(my.data$data.from == "train"), ], 
       mapping = aes(x = budget, y = revenue)) + 
  geom_point(col = "#f44e42") +
  geom_smooth(method = "lm", se = FALSE) +
  ggtitle("Revenue Vs Budget") +
  xlab("Budget") +
  ylab("Revenue") +
  scale_x_continuous(labels = dollar) +
  scale_y_continuous(labels = dollar)


# Scatter plot between popularity of a movie and revenue
ggplot(data = my.data[which(my.data$data.from == "train"), ], 
       mapping = aes(x = popularity, y = revenue)) + 
  geom_point(col = "#f44e42") +
  geom_smooth(method = "lm", se = FALSE) +
  ggtitle("Revenue Vs popularity") +
  xlab("popularity") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

# bar graph revenue generated by english, hindi and others 
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = language, y = revenue, fill = language)) +
  stat_summary_bin(fun.y = "sum", geom = "bar", position = position_stack(reverse = T))+
  coord_flip() +
  ggtitle("Revenue Vs Language") +
  xlab("Language") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)
ggsave("Plots/Revenue Vs Language.png")

#10 collections
  
total.revenue.df = (aggregate(my.data$revenue, by = list(my.data$movie_collection), FUN = sum, na.rm = T))
colnames(total.revenue.df) = c("collection", "revenue")
write.csv(total.revenue.df, file = "collection_revenue.csv", row.names = F)

# total.revenue.df contains only top 10 collections
total.revenue.df = head(total.revenue.df[order(total.revenue.df$revenue, decreasing = TRUE), ], 10)

# Plot bar graph for top 10 collection
ggplot(data = total.revenue.df,
       mapping = aes(x = reorder(collection, revenue), y = revenue)) +
  geom_bar(stat = "identity", fill = "#f44e42") +
  coord_flip() +
  ggtitle("Top 10 Collection Revenue") +
  xlab("Collection") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/Top_10_Collection_Revenue.png")

# Top 10 movies revenue

movie.revenue.df = (aggregate(my.data$revenue, by = list(my.data$original_title), FUN = sum, na.rm = T))
colnames(movie.revenue.df) = c("movie", "revenue")
# write.csv(total.revenue.df, file = "collection_revenue.csv", row.names = F)

# movie.revenue.df contains only top 10 movies
movie.revenue.df = head(movie.revenue.df[order(movie.revenue.df$revenue, decreasing = TRUE), ], 10)

# Plot bar graph for top 10 movies
ggplot(data = movie.revenue.df,
       mapping = aes(x = reorder(movie, revenue), y = revenue)) +
  geom_bar(stat = "identity", fill = "#75ea92") +
  coord_flip() +
  ggtitle("Top 10 Movies Revenue") +
  xlab("Movie") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/Top_10_Movies_Revenue.png")

# Plot a graph between runtime and revenue
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = runtime, y = revenue)) +
  geom_point(col = "#f44e42")+
  geom_smooth(method = "loess", se = F) +
  ggtitle("Revenue Vs Runtime") +
  xlab("Runtime") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/RuntimeVsRevenue.png")

# Plot a scatter graph between noOfCountries and revenue
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = noOfCountries, y = revenue)) +
  geom_point(col = "#f44e42")+
  geom_smooth(method = "lm", se = F) +
  ggtitle("Revenue Vs noOfCountries") +
  xlab("noOfCountries") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/noOfCountries Vs Revenue.png")

# Plot a scatter plot between noOfCompany and revenue
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = noOfCompany, y = revenue)) +
  geom_point(col = "#426bf4")+
  geom_smooth(method = "lm", se = F) +
  ggtitle("Revenue Vs noOfCompany") +
  xlab("noOfCompany") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/noOfCompany Vs Revenue.png")

# Plot a scatter plot between cast_count and revenue
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = cast_count, y = revenue)) +
  geom_point(col = "#f48042")+
  geom_smooth(method = "lm", se = F) +
  ggtitle("Revenue Vs cast_count") +
  xlab("cast_count") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/cast_count Vs Revenue.png")

# Plot a scatter plot between male_cast and revenue
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = male_cast, y = revenue)) +
  geom_point(col = "#9dd82f")+
  geom_smooth(method = "lm", se = F) +
  ggtitle("Revenue Vs male_cast") +
  xlab("male_cast") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/male_cast Vs Revenue.png")

# Plot a scatter plot between female_cast and revenue
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = female_cast, y = revenue)) +
  geom_point(col = "#590c20")+
  geom_smooth(method = "lm", se = F) +
  ggtitle("Revenue Vs female_cast") +
  xlab("female_cast") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/female_cast Vs Revenue.png")

# ------------------crew--------------------------

# Plot a scatter plot between cast_count and revenue
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = crew_count, y = revenue)) +
  geom_point(col = "#f48042")+
  geom_smooth(method = "lm", se = F) +
  ggtitle("Revenue Vs crew_count") +
  xlab("crew_count") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/crew_count Vs Revenue.png")

# Plot a scatter plot between male_crew and revenue
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = male_crew, y = revenue)) +
  geom_point(col = "#9dd82f")+
  geom_smooth(method = "lm", se = F) +
  ggtitle("Revenue Vs male_crew") +
  xlab("male_crew") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/male_crew Vs Revenue.png")

# Plot a scatter plot between female_crew and revenue
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = female_crew, y = revenue)) +
  geom_point(col = "#590c20")+
  geom_smooth(method = "lm", se = F) +
  ggtitle("Revenue Vs female_crew") +
  xlab("female_crew") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/female_crew Vs Revenue.png")

#----------------------Release date-----------------------------
# Plot a scatter plot between release year and revenue
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = year, y = revenue)) +
  geom_point(col = "#590c20")+
  geom_smooth(method = "lm", se = F) +
  ggtitle("Revenue Vs year") +
  xlab("year") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/year Vs Revenue.png")

# Plot a bar graph between release day and revenue
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = week_day, y = revenue, fill = week_day)) +
  stat_summary_bin(fun.y = "sum", geom = "bar", position = position_stack(reverse = T))+
  coord_flip() +
  ggtitle("Revenue Vs Day") +
  xlab("Day") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/Day Vs Revenue.png")

# Plot a bar graph between release month and revenue
ggplot(data = my.data[my.data$data.from == 'train', ], 
       mapping = aes(x = month, y = revenue, fill = month)) +
  stat_summary_bin(fun.y = "sum", geom = "bar", position = position_stack(reverse = T))+
  coord_flip() +
  ggtitle("Revenue Vs Month") +
  xlab("Month") +
  ylab("Revenue") +
  scale_y_continuous(labels = dollar)

ggsave("Plots/Month Vs Revenue.png")

# Plot a bar graph for missing value
ggplot(data = missing_val, mapping = aes(x = reorder(na_varname, na_per), y = na_per, fill = na_varname)) +
  geom_bar(stat = "identity", position = position_stack(reverse = T)) +
  coord_flip() +
  ggtitle("Missing value") +
  xlab("Features") +
  ylab("Missing %") 

ggsave("Plots/MissingValues.png")
